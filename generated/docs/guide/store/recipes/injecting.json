{
  "id": "guide/store/recipes/injecting",
  "title": "Using Dependency Injection",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/store/recipes/injecting.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"using-dependency-injection\">Using Dependency Injection<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/recipes/injecting#using-dependency-injection\"><i class=\"material-icons\">link</i></a></h1>\n<h2 id=\"injecting-reducers\">Injecting Reducers<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/recipes/injecting#injecting-reducers\"><i class=\"material-icons\">link</i></a></h2>\n<p>To inject the root reducers into your application, use an <code>InjectionToken</code> and a <code>Provider</code> to register the reducers through dependency injection.</p>\n<code-example header=\"app.module.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { NgModule, InjectionToken } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/store/StoreModule\" class=\"code-anchor\">StoreModule</a>, <a href=\"api/store/ActionReducerMap\" class=\"code-anchor\">ActionReducerMap</a> } from '@ngrx/store';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { SomeService } from './some.service';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> * as fromRoot from './reducers';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> const REDUCER_TOKEN = new InjectionToken&#x3C;<a href=\"api/store/ActionReducerMap\" class=\"code-anchor\">ActionReducerMap</a>&#x3C;fromRoot.State>>('Registered Reducers', {\n  factory: () => {\n    const serv = inject(SomeService);\n    // return reducers synchronously\n    return serv.getReducers();\n  }\n});\n\n@NgModule({\n  imports: [StoreModule.forRoot(REDUCER_TOKEN)]\n})\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class AppModule {}\n</code-example>\n<p>Reducers are also injected when composing state through feature modules.</p>\n<code-example header=\"feature.module.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { NgModule, InjectionToken } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/store/StoreModule\" class=\"code-anchor\">StoreModule</a>, <a href=\"api/store/ActionReducerMap\" class=\"code-anchor\">ActionReducerMap</a> } from '@ngrx/store';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> * as fromFeature from './reducers';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> const FEATURE_REDUCER_TOKEN = new InjectionToken&#x3C;\n  <a href=\"api/store/ActionReducerMap\" class=\"code-anchor\">ActionReducerMap</a>&#x3C;fromFeature.State>\n>('Feature Reducers');\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> function getReducers(): <a href=\"api/store/ActionReducerMap\" class=\"code-anchor\">ActionReducerMap</a>&#x3C;fromFeature.State> {\n  // map of reducers\n  return {};\n}\n\n@NgModule({\n  imports: [StoreModule.forFeature(fromFeature.featureKey, FEATURE_REDUCER_TOKEN)],\n  providers: [\n    {\n      provide: FEATURE_REDUCER_TOKEN,\n      useFactory: getReducers,\n    },\n  ],\n})\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class FeatureModule {}\n</code-example>\n<h2 id=\"injecting-meta-reducers\">Injecting Meta-Reducers<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/recipes/injecting#injecting-meta-reducers\"><i class=\"material-icons\">link</i></a></h2>\n<p>To inject 'middleware' meta reducers, use the <code><a href=\"api/store/META_REDUCERS\" class=\"code-anchor\">META_REDUCERS</a></code> injection token exported in\nthe Store API and a <code>Provider</code> to register the meta reducers through dependency\ninjection.</p>\n<code-example header=\"app.module.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/store/MetaReducer\" class=\"code-anchor\">MetaReducer</a>, <a href=\"api/store/META_REDUCERS\" class=\"code-anchor\">META_REDUCERS</a> } from '@ngrx/store';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { SomeService } from './some.service';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> * as fromRoot from './reducers';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> function metaReducerFactory(): <a href=\"api/store/MetaReducer\" class=\"code-anchor\">MetaReducer</a>&#x3C;fromRoot.State> {\n  return (<a href=\"api/store/On#reducer\" class=\"code-anchor\">reducer</a>: <a href=\"api/store/ActionReducer\" class=\"code-anchor\">ActionReducer</a>&#x3C;any>) => (<a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a>, action) => {\n    console.log('<a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a>', <a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a>);\n    console.log('action', action);\n    return <a href=\"api/store/On#reducer\" class=\"code-anchor\">reducer</a>(<a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a>, action);\n  };\n}\n\n@NgModule({\n  providers: [\n    {\n      provide: <a href=\"api/store/META_REDUCERS\" class=\"code-anchor\">META_REDUCERS</a>,\n      deps: [SomeService],\n      useFactory: metaReducerFactory,\n      multi: true,\n    },\n  ],\n})\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class AppModule {}\n</code-example>\n<div class=\"alert is-important\">\n<p>Careful attention should be called to the use of the <code>multi</code>\nproperty in the provider here for <code><a href=\"api/store/META_REDUCERS\" class=\"code-anchor\">META_REDUCERS</a></code>. As this injection token may be utilized\nby many libraries concurrently, specifying <code>multi: true</code> is critical to ensuring that all\nlibrary meta reducers are applied to any project that consumes multiple NgRx libraries with\nregistered meta reducers.</p>\n</div>\n<h2 id=\"injecting-feature-config\">Injecting Feature Config<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/recipes/injecting#injecting-feature-config\"><i class=\"material-icons\">link</i></a></h2>\n<p>To inject the feature store configuration into your module, use an <code>InjectionToken</code> and a <code>Provider</code> to register the feature config object through dependency injection.</p>\n<code-example header=\"feature.module.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { NgModule, InjectionToken } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/store/StoreModule\" class=\"code-anchor\">StoreModule</a>, <a href=\"api/store/StoreConfig\" class=\"code-anchor\">StoreConfig</a> } from '@ngrx/store';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { SomeService } from './some.service';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> * as fromFeature from './reducers';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> const FEATURE_CONFIG_TOKEN = new InjectionToken&#x3C;<a href=\"api/store/StoreConfig\" class=\"code-anchor\">StoreConfig</a>&#x3C;fromFeature.State>>('Feature Config');\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> function getConfig(someService: SomeService): <a href=\"api/store/StoreConfig\" class=\"code-anchor\">StoreConfig</a>&#x3C;fromFeature.State> {\n  // return the <a href=\"api/data/DefaultDataServiceFactory#config\" class=\"code-anchor\">config</a> synchronously.\n  return {\n    initialState: someService.getInitialState(),\n\n    <a href=\"api/store/StoreConfig#metaReducers\" class=\"code-anchor\">metaReducers</a>: [\n      fromFeature.loggerFactory(someService.loggerConfig())\n    ]\n  };\n}\n\n@NgModule({\n  imports: [StoreModule.forFeature(fromFeature.featureKey, fromFeature.reducers, FEATURE_CONFIG_TOKEN)],\n  providers: [\n    {\n      provide: FEATURE_CONFIG_TOKEN,\n      deps: [SomeService],\n      useFactory: getConfig,\n    },\n  ],\n})\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class FeatureModule {}\n</code-example>\n\n</div>\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - api/data/DefaultDataServiceFactory#config\n - api/store-devtools/DevToolsFeatureOptions#export\n - api/store-devtools/DevToolsFeatureOptions#import\n - api/store-devtools/StoreDevtools#state\n - api/store/ActionReducer\n - api/store/ActionReducerMap\n - api/store/META_REDUCERS\n - api/store/MetaReducer\n - api/store/On#reducer\n - api/store/StoreConfig\n - api/store/StoreConfig#metaReducers\n - api/store/StoreModule\n - guide/store/recipes/injecting#injecting-feature-config\n - guide/store/recipes/injecting#injecting-meta-reducers\n - guide/store/recipes/injecting#injecting-reducers\n - guide/store/recipes/injecting#using-dependency-injection\n - https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/store/recipes/injecting.md?message=docs%3A%20describe%20your%20change...\n-->"
}