{
  "id": "guide/component-store/read",
  "title": "Reading state",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/ngrx/platform/edit/main/projects/ngrx.io/content/guide/component-store/read.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"reading-state\">Reading state<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#reading-state\"><i class=\"material-icons\">link</i></a></h1>\n<h2 id=\"select-method\"><code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#select-method\"><i class=\"material-icons\">link</i></a></h2>\n<p>Reading state is done with the <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method, which takes a projector that describes HOW the state is retrieved and/or transformed.\nSelectors emit new values when those values \"change\" - the new value is no longer distinct by comparison from the previous value.</p>\n<p>Another performance benefit of selectors is that they are \"shared\" - they multicast the value to each subscriber.</p>\n<code-example header=\"movies.store.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> interface MoviesState {\n  movies: Movie[];\n}\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class MoviesStore extends <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a>&#x3C;MoviesState> {\n  \n  constructor() {\n    super({movies:[]});\n  }\n\n  readonly movies$: Observable&#x3C;Movie[]> = this.select(state => state.movies);\n}\n</code-example>\n<code-example header=\"movies-page.component.ts\">\n@Component({\n  template: `\n    &#x3C;li *ngFor=\"let movie of (movies$ | async)\">\n      {{ movie.name }}\n    &#x3C;/li>\n  `,\n  providers: [MoviesStore],\n})\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class MoviesPageComponent {\n  movies$ = this.moviesStore.movies$;\n\n  constructor(private readonly moviesStore: MoviesStore) {}\n}\n</code-example>\n<h2 id=\"combining-selectors\">Combining selectors<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#combining-selectors\"><i class=\"material-icons\">link</i></a></h2>\n<p>Selectors can be used to combine other Selectors or Observables.</p>\n<code-example header=\"movies.store.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> interface MoviesState {\n  movies: Movie[];\n  userPreferredMoviesIds: string[];\n}\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class MoviesStore extends <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a>&#x3C;MoviesState> {\n  \n  constructor() {\n    super({movies:[], userPreferredMoviesIds:[]});\n  }\n\n  readonly movies$ = this.select(state => state.movies);\n  readonly userPreferredMovieIds$ = this.select(state => state.userPreferredMoviesIds);\n\n  readonly userPreferredMovies$ = this.select(\n        this.movies$,\n        this.userPreferredMovieIds$,\n        (movies, <a href=\"api/entity/EntityState#ids\" class=\"code-anchor\">ids</a>) => movies.filter(movie => ids.includes(movie.id))\n  );\n}\n</code-example>\n<h2 id=\"creating-a-view-model\">Creating a View Model<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#creating-a-view-model\"><i class=\"material-icons\">link</i></a></h2>\n<p>Creating view models is a recommended way to consolidate multiple streams in a clean API to provide to your component template.\nThe <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method accepts a dictionary of observables as input and returns an observable of the dictionary of values as output. View models can be written in the following way: </p>\n<code-example header=\"movies.store.ts\">\n  private readonly vm$ = this.select({\n    movies: this.movies$,\n    userPreferredMovieIds: this.userPreferredMovieIds$,\n    userPreferredMovies: this.userPreferredMovies$\n  });\n</code-example>\n<h2 id=\"debounce-selectors\">Debounce selectors<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#debounce-selectors\"><i class=\"material-icons\">link</i></a></h2>\n<p>Selectors are synchronous by default, meaning that they emit the value immediately when subscribed to, and on every state change.\nSometimes the preferred behavior would be to wait (or debounce) until the state \"settles\" (meaning all the changes within the current microtask occur)\nand only then emit the final value.\nIn many cases, this would be the most performant way to read data from the ComponentStore, however its behavior might be surprising sometimes, as it won't emit a value until later on.\nThis makes it harder to test such selectors.</p>\n<p>Adding the debounce to a selector is done by passing <code>{<a href=\"api/component-store/SelectConfig#debounce\" class=\"code-anchor\">debounce</a>: true}</code> as the last argument.</p>\n<code-example header=\"movies.store.ts\">\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class MoviesStore extends <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a>&#x3C;MoviesState> {\n  \n  constructor(private movieService: MovieService) {\n    super({movies: [], moviesPerPage: 10, currentPageIndex: 0});\n \n    // ðŸ‘‡ <a href=\"api/effects/EffectNotification#effect\" class=\"code-anchor\">effect</a> is triggered whenever debounced data is <a href=\"api/data/UpdateResponseData#changed\" class=\"code-anchor\">changed</a>\n    this.fetchMovies(this.fetchMoviesData$);\n  }\n\n  // Updates how many movies per page should be displayed\n  readonly updateMoviesPerPage = this.updater((state, moviesPerPage: number) => ({\n    ...state,\n    moviesPerPage, // updates with new <a href=\"api/store/testing/MockSelector#value\" class=\"code-anchor\">value</a>\n  }));\n\n  // Updates which page of movies that the user is currently <a href=\"api/store/on\" class=\"code-anchor\">on</a>\n  readonly updateCurrentPageIndex = this.updater((state, currentPageIndex: number) => ({\n    ...state,\n    currentPageIndex, // updates with new page index\n  }));\n\n  readonly moviesPerPage$ = this.select(state => state.moviesPerPage);\n\n  readonly currentPageIndex$ = this.select(state => state.currentPageIndex);\n\n  private readonly fetchMoviesData$ = this.select({\n    moviesPerPage: this.moviesPerPage$,\n    currentPageIndex: this.currentPageIndex$\n  },{<a href=\"api/component-store/SelectConfig#debounce\" class=\"code-anchor\">debounce</a>: true}, // ðŸ‘ˆ setting this <a href=\"api/store/testing/MockSelector#selector\" class=\"code-anchor\">selector</a> to <a href=\"api/component-store/SelectConfig#debounce\" class=\"code-anchor\">debounce</a>\n  );\n  \n  private readonly fetchMovies = this.effect(\n    (moviePageData$: Observable&#x3C;{moviesPerPage: number; currentPageIndex: number}>) => {\n      return moviePageData$.pipe(\n        concatMap(({moviesPerPage, currentPageIndex}) => {\n          return this.movieService\n            .loadMovies(moviesPerPage, currentPageIndex)\n            .pipe(tap((results) => this.updateMovieResults(results)));\n        }),\n      );\n    },\n  );\n}\n</code-example>\n<h2 id=\"using-a-custom-equality-function\">Using a custom equality function<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#using-a-custom-equality-function\"><i class=\"material-icons\">link</i></a></h2>\n<p>The observable created by the <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method compares the newly emitted value with the previous one using the default equality check (<code>===</code>) and emits only if the value has changed. However, the default behavior can be overridden by passing a custom equality function to the <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method config.</p>\n<code-example header=\"movies.store.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> interface MoviesState {\n  movies: Movie[];\n}\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class MoviesStore extends <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a>&#x3C;MoviesState> {\n  \n  constructor() {\n    super({movies:[]});\n  }\n\n  readonly movies$: Observable&#x3C;Movie[]> = this.select(\n    state => state.movies,\n    {<a href=\"api/component-store/SelectConfig#equal\" class=\"code-anchor\">equal</a>: (prev, curr) => prev.length === curr.length} // ðŸ‘ˆ custom equality function\n  );\n}\n</code-example>\n<h2 id=\"selecting-from-global-ngrxstore\">Selecting from global <code>@ngrx/store</code><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#selecting-from-global-ngrxstore\"><i class=\"material-icons\">link</i></a></h2>\n<p>ComponentStore is an independent library, however it can easily consume data from <code>@ngrx/store</code> or from any other global state management library.</p>\n<code-example header=\"movies.store.ts\">\nprivate readonly fetchMoviesData$ = this.select(\n  this.store.select(getUserId), // ðŸ‘ˆ store.select returns an Observable, which is easily mixed within <a href=\"api/store/testing/MockSelector#selector\" class=\"code-anchor\">selector</a>\n  moviesPerPage$,\n  currentPageIndex$,\n  (userId, moviesPerPage, currentPageIndex) => ({userId, moviesPerPage, currentPageIndex}),\n);\n</code-example>\n<h2 id=\"selectsignal-method\"><code>selectSignal</code> method<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#selectsignal-method\"><i class=\"material-icons\">link</i></a></h2>\n<p>ComponentStore also provides the <code>selectSignal</code> method, which has two signatures.\nThe first signature creates a signal from the provided state projector function.\nThe second signature creates a signal by combining the provided signals, this is similar to the <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method that combines the provided observables.</p>\n<code-example header=\"users.store.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { Injectable } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a> } from '@ngrx/component-store';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { User } from './user.model';\n\ntype UsersState = { users: User[]; query: string };\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class UsersStore extends <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a>&#x3C;UsersState> {\n  // type: Signal&#x3C;User[]>\n  readonly users = this.selectSignal((s) => s.users);\n  // type: Signal&#x3C;string>\n  readonly query = this.selectSignal((s) => s.query);\n  // type: Signal&#x3C;User[]>\n  readonly filteredUsers = this.selectSignal(\n    this.users,\n    this.query,\n    (users, query) =>\n      users.filter(({ name }) => name.includes(query))\n  );\n}\n</code-example>\n<p>The <code>selectSignal</code> method also accepts an equality function to stop the recomputation of the deeper dependency chain if two values are determined to be equal.</p>\n<h2 id=\"state-signal\"><code>state</code> signal<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#state-signal\"><i class=\"material-icons\">link</i></a></h2>\n<p>The <code>state</code> signal returns the entire state of the ComponentStore.</p>\n<p>Use the <code>state</code> signal to create computed signals that derives its value from the state.</p>\n<code-example header=\"users.store.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { computed, Injectable } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a> } from '@ngrx/component-store';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { User } from './user.model';\n\ntype UsersState = { users: User[]; query: string };\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class UsersStore extends <a href=\"api/component-store/ComponentStore\" class=\"code-anchor\">ComponentStore</a>&#x3C;UsersState> {\n  readonly users = computed(() => this.state().users);\n  readonly query = computed(() => this.state().query);\n  \n  readonly filteredUsers = computed(() =>\n    this.users().filter(({ name }) => name.includes(this.query()))\n  );\n}\n</code-example>\n<h2 id=\"get-method\"><code>get</code> method<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/component-store/read#get-method\"><i class=\"material-icons\">link</i></a></h2>\n<p>While a selector provides a reactive way to read the state from ComponentStore via Observable, sometimes an imperative read is needed.\nOne of such use cases is accessing the state within an <code><a href=\"api/effects/EffectNotification#effect\" class=\"code-anchor\">effect</a></code>s and that's where <code>get</code> method could be used.</p>\n<div class=\"alert is-critical\">\n<p>The <code>get</code> method is ComponentStore-private, meaning it's accessible only within the ComponentStore. It's done to discourage frequent imperative reads\nfrom the state as the NgRx team is in a consensus that such reads promote further potentially harmful architectural decisions.</p>\n</div>\n\n</div>\n\n<!-- links to this doc:\n - guide/component-store\n - guide/component-store/usage\n-->\n<!-- links from this doc:\n - api/component-store/ComponentStore\n - api/component-store/SelectConfig#debounce\n - api/component-store/SelectConfig#equal\n - api/data/UpdateResponseData#changed\n - api/effects/EffectNotification#effect\n - api/entity/EntityState#ids\n - api/store-devtools/DevToolsFeatureOptions#export\n - api/store-devtools/DevToolsFeatureOptions#import\n - api/store/on\n - api/store/select\n - api/store/testing/MockSelector#selector\n - api/store/testing/MockSelector#value\n - guide/component-store/read#combining-selectors\n - guide/component-store/read#creating-a-view-model\n - guide/component-store/read#debounce-selectors\n - guide/component-store/read#get-method\n - guide/component-store/read#reading-state\n - guide/component-store/read#select-method\n - guide/component-store/read#selecting-from-global-ngrxstore\n - guide/component-store/read#selectsignal-method\n - guide/component-store/read#state-signal\n - guide/component-store/read#using-a-custom-equality-function\n - https://github.com/ngrx/platform/edit/main/projects/ngrx.io/content/guide/component-store/read.md?message=docs%3A%20describe%20your%20change...\n-->"
}