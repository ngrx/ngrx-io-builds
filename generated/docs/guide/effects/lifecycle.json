{
  "id": "guide/effects/lifecycle",
  "title": "Lifecycle",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/effects/lifecycle.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"lifecycle\">Lifecycle<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#lifecycle\"><i class=\"material-icons\">link</i></a></h1>\n<h3 id=\"root_effects_init\">ROOT_EFFECTS_INIT<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#root_effects_init\"><i class=\"material-icons\">link</i></a></h3>\n<p>After all the root effects have been added, the root effect dispatches a <code><a href=\"api/effects/ROOT_EFFECTS_INIT\" class=\"code-anchor\">ROOT_EFFECTS_INIT</a></code> action.\nYou can see this action as a lifecycle hook, which you can use in order to execute some code after all your root effects have been added.</p>\n<code-example header=\"init.effects.ts\">\ninit$ = <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a>(() => \n  this.actions$.pipe(\n    <a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>(<a href=\"api/effects/ROOT_EFFECTS_INIT\" class=\"code-anchor\">ROOT_EFFECTS_INIT</a>),\n    map(action => ...)\n  )\n);\n</code-example>\n<h2 id=\"effect-metadata\">Effect Metadata<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#effect-metadata\"><i class=\"material-icons\">link</i></a></h2>\n<h3 id=\"non-dispatching-effects\">Non-dispatching Effects<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#non-dispatching-effects\"><i class=\"material-icons\">link</i></a></h3>\n<p>Sometimes you don't want effects to dispatch an action, for example when you only want to log or navigate based on an incoming action. But when an effect does not dispatch another action, the browser will crash because the effect is both 'subscribing' to and 'dispatching' the exact same action, causing an infinite loop. To prevent this, add <code>{ dispatch: false }</code> to the <code><a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a></code> function as the second argument.</p>\n<p>Usage:</p>\n<code-example header=\"log.effects.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { Injectable } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a>, <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a> } from '@ngrx/effects';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { tap } from 'rxjs/operators';\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class LogEffects {\n  constructor(private actions$: <a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a>) {}\n  \n  logActions$ = <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a>(() =>\n    this.actions$.pipe(\n      tap(action => console.log(action))\n    ), { dispatch: false });\n}\n</code-example>\n<h3 id=\"resubscribe-on-error\">Resubscribe on Error<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#resubscribe-on-error\"><i class=\"material-icons\">link</i></a></h3>\n<p>Starting with version 8, when an error happens in the effect's main stream it is\nreported using Angular's <code>ErrorHandler</code>, and the source effect is\n<strong>automatically</strong> resubscribed to (instead of completing), so it continues to\nlisten to all dispatched Actions.</p>\n<p>Generally, errors should be handled by users. However, for the cases where errors were missed,\nthis new behavior adds an additional safety net.</p>\n<p>In some cases where particular RxJS operators are used, the new behavior might\nproduce unexpected results. For example, if the <code>startWith</code> operator is within the\neffect's pipe then it will be triggered again.</p>\n<p>To disable resubscriptions add <code>{<a href=\"api/effects/EffectConfig#useEffectsErrorHandler\" class=\"code-anchor\">useEffectsErrorHandler</a>: false}</code> to the <code><a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a></code>\nmetadata (second argument).</p>\n<code-example header=\"disable-resubscribe.effects.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { Injectable } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a>, <a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>, <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a> } from '@ngrx/effects';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { of } from 'rxjs';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { catchError, exhaustMap, map } from 'rxjs/operators';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> {\n  LoginPageActions,\n  AuthApiActions,\n} from '../actions';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { AuthService } from '../<a href=\"api/data/EntityDataService#services\" class=\"code-anchor\">services</a>/auth.service';\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class AuthEffects {\n  logins$ = <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a>(\n    () =>\n      this.actions$.pipe(\n        <a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>(LoginPageActions.login),\n        exhaustMap(action =>\n          this.authService.login(action.credentials).pipe(\n            map(user => AuthApiActions.loginSuccess({ user })),\n            catchError(error => of(AuthApiActions.loginFailure({ error })))\n          )\n        )\n        // Errors are handled and it is safe to disable resubscription\n      ),\n    { <a href=\"api/effects/EffectConfig#useEffectsErrorHandler\" class=\"code-anchor\">useEffectsErrorHandler</a>: false }\n  );\n\n  constructor(\n    private actions$: <a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a>,\n    private authService: AuthService\n  ) {}\n}\n</code-example>\n<h3 id=\"customizing-the-effects-error-handler\">Customizing the Effects Error Handler<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#customizing-the-effects-error-handler\"><i class=\"material-icons\">link</i></a></h3>\n<p>The behavior of the default resubscription handler can be customized\nby providing a custom handler using the <code><a href=\"api/effects/EFFECTS_ERROR_HANDLER\" class=\"code-anchor\">EFFECTS_ERROR_HANDLER</a></code> injection token.</p>\n<p>This allows you to provide a custom behavior, such as only retrying on\ncertain \"retryable\" errors, or with maximum number of retries.</p>\n<code-example header=\"customise-error-handler.effects.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { ErrorHandler, NgModule } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { Observable, throwError } from 'rxjs';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { retryWhen, mergeMap } from 'rxjs/operators';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/store/Action\" class=\"code-anchor\">Action</a> } from '@ngrx/store';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { <a href=\"api/effects/EffectsModule\" class=\"code-anchor\">EffectsModule</a>, <a href=\"api/effects/EFFECTS_ERROR_HANDLER\" class=\"code-anchor\">EFFECTS_ERROR_HANDLER</a> } from '@ngrx/effects';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { MovieEffects } from './effects/movie.effects';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { CustomErrorHandler, isRetryable } from '../custom-error-handler';\n\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> function effectResubscriptionHandler>T extends <a href=\"api/store/Action\" class=\"code-anchor\">Action</a>&#x3C;(\n  observable$: Observable>T&#x3C;,\n  errorHandler?: CustomErrorHandler\n): Observable>T&#x3C; {\n  return observable$.pipe(\n    retryWhen(errors =>\n      errors.pipe(\n        mergeMap(e => {\n          if (isRetryable(e)) {\n            return errorHandler.handleRetryableError(e);\n          }\n\n          errorHandler.handleError(e);\n          return throwError(e);\n        })\n      )\n    )\n  );\n}\n\n@NgModule({\n  imports: [EffectsModule.forRoot([MovieEffects])],\n  providers: [\n    {\n      provide: <a href=\"api/effects/EFFECTS_ERROR_HANDLER\" class=\"code-anchor\">EFFECTS_ERROR_HANDLER</a>,\n      useValue: effectResubscriptionHandler,\n    },\n    {\n      provide: ErrorHandler, \n      useClass: CustomErrorHandler \n    }\n  ],\n})\n</code-example>\n<h2 id=\"controlling-effects\">Controlling Effects<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#controlling-effects\"><i class=\"material-icons\">link</i></a></h2>\n<h3 id=\"oniniteffects\">OnInitEffects<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#oniniteffects\"><i class=\"material-icons\">link</i></a></h3>\n<p>Implement this interface to dispatch a custom action after the effect has been added.\nYou can listen to this action in the rest of the application to execute something after the effect is registered.</p>\n<p>Usage:</p>\n<code-example header=\"user.effects.ts\">\nclass UserEffects implements <a href=\"api/effects/OnInitEffects\" class=\"code-anchor\">OnInitEffects</a> {\n  ngrxOnInitEffects(): <a href=\"api/store/Action\" class=\"code-anchor\">Action</a> {\n    return { type: '[UserEffects]: Init' };\n  }\n}\n</code-example>\n<h3 id=\"onruneffects\">OnRunEffects<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#onruneffects\"><i class=\"material-icons\">link</i></a></h3>\n<p>By default, effects are merged and subscribed to the store. Implement the <code><a href=\"api/effects/OnRunEffects\" class=\"code-anchor\">OnRunEffects</a></code> interface to control the lifecycle of the resolved effects.</p>\n<p>Usage:</p>\n<code-example header=\"user.effects.ts\">\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { Injectable } from '@angular/core';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { Observable } from 'rxjs';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> { exhaustMap, takeUntil, tap } from 'rxjs/operators';\n<a href=\"api/store-devtools/DevToolsFeatureOptions#import\" class=\"code-anchor\">import</a> {\n  <a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a>,\n  <a href=\"api/effects/OnRunEffects\" class=\"code-anchor\">OnRunEffects</a>,\n  <a href=\"api/effects/EffectNotification\" class=\"code-anchor\">EffectNotification</a>,\n  <a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>,\n  <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a>,\n} from '@ngrx/effects';\n\n@Injectable()\n<a href=\"api/store-devtools/DevToolsFeatureOptions#export\" class=\"code-anchor\">export</a> class UserEffects implements <a href=\"api/effects/OnRunEffects\" class=\"code-anchor\">OnRunEffects</a> {\n  constructor(private actions$: <a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a>) {}\n\n  updateUser$ = <a href=\"api/effects/createEffect\" class=\"code-anchor\">createEffect</a>(() =>\n      this.actions$.pipe(\n        <a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>('UPDATE_USER'),\n        tap(action => {\n          console.log(action);\n        })\n      ),\n    { dispatch: false });\n\n  ngrxOnRunEffects(resolvedEffects$: Observable&#x3C;<a href=\"api/effects/EffectNotification\" class=\"code-anchor\">EffectNotification</a>>) {\n    return this.actions$.pipe(\n      <a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>('LOGGED_IN'),\n      exhaustMap(() =>\n        resolvedEffects$.pipe(\n          takeUntil(this.actions$.pipe(<a href=\"api/effects/ofType\" class=\"code-anchor\">ofType</a>('LOGGED_OUT')))\n        )\n      )\n    );\n  }\n}\n</code-example>\n<h3 id=\"identify-effects-uniquely\">Identify Effects Uniquely<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/effects/lifecycle#identify-effects-uniquely\"><i class=\"material-icons\">link</i></a></h3>\n<p>By default, each Effects class is registered once regardless of how many times the Effect class is loaded.\nBy implementing this interface, you define a unique identifier to register an Effects class instance multiple times.</p>\n<p>Usage:</p>\n<code-example header=\"user.effects.ts\">\nclass EffectWithIdentifier implements <a href=\"api/effects/OnIdentifyEffects\" class=\"code-anchor\">OnIdentifyEffects</a> {\n  constructor(private effectIdentifier: string) {}\n\n  ngrxOnIdentifyEffects() {\n    return this.effectIdentifier;\n  }\n}\n</code-example>\n\n</div>\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - api/data/EntityDataService#services\n - api/effects/Actions\n - api/effects/EFFECTS_ERROR_HANDLER\n - api/effects/EffectConfig#useEffectsErrorHandler\n - api/effects/EffectNotification\n - api/effects/EffectsModule\n - api/effects/OnIdentifyEffects\n - api/effects/OnInitEffects\n - api/effects/OnRunEffects\n - api/effects/ROOT_EFFECTS_INIT\n - api/effects/createEffect\n - api/effects/ofType\n - api/store-devtools/DevToolsFeatureOptions#export\n - api/store-devtools/DevToolsFeatureOptions#import\n - api/store/Action\n - guide/effects/lifecycle#controlling-effects\n - guide/effects/lifecycle#customizing-the-effects-error-handler\n - guide/effects/lifecycle#effect-metadata\n - guide/effects/lifecycle#identify-effects-uniquely\n - guide/effects/lifecycle#lifecycle\n - guide/effects/lifecycle#non-dispatching-effects\n - guide/effects/lifecycle#oniniteffects\n - guide/effects/lifecycle#onruneffects\n - guide/effects/lifecycle#resubscribe-on-error\n - guide/effects/lifecycle#root_effects_init\n - https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/effects/lifecycle.md?message=docs%3A%20describe%20your%20change...\n-->"
}